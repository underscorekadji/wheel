#!/usr/bin/env sh

# Skip Husky commit-msg when running in CI (e.g., GitHub Actions)
if [ "$GITHUB_ACTIONS" = "true" ] || [ "$CI" = "true" ]; then
  echo "ℹ️  Skipping commit-msg hook in CI environment"
  exit 0
fi

echo "🔍 Checking commit message format..."

# Run commitlint to validate commit message against conventional commits
if ! npx commitlint --edit "$1"; then
  echo ""
  echo "❌ Commit message does not follow conventional commit format!"
  echo ""
  echo "📝 Expected format: type(scope): subject"
  echo ""
  echo "✅ Valid types: feat, fix, docs, style, refactor, perf, test, chore, ci, build, revert"
  echo ""
  echo "📋 Examples:"
  echo "  feat(component): add new button variant"
  echo "  fix(api): resolve user authentication issue"
  echo "  docs(readme): update installation instructions"
  echo "  chore(deps): update next.js to latest version"
  echo ""
  echo "🔗 Learn more: https://conventionalcommits.org/"
  exit 1
fi

echo "✅ Commit message format is valid!"